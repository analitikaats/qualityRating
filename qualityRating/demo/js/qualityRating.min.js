window.app = window.app || {}, $(function() { function b() { var b = JSZip(); b.loadAsync(dataZip, { base64: !0, optimizedBinaryString: !0 }).then(function(c) { b.file(new RegExp(".json"))[0].async("string").then(function(b) { window.app = JSON.parse(b), a(window.app.data.dataGridQualityRating) }) }) } var a = ko.observableArray(); b(), $(".progression-single").mediaelementplayer({ stretching: "auto", audioHeight: 35, startVolume: 1, features: ["playpause", "current", "progress", "duration", "tracks", "volume"], isVideo: !1 }), $.when($.getJSON("js/devextreme/js/unicode-cldr/ca-gregorian.json"), $.getJSON("js/devextreme/js/unicode-cldr/numbers.json"), $.getJSON("js/devextreme/js/unicode-cldr/currencies.json"), $.getJSON("js/devextreme/js/unicode-cldr/likelySubtags.json"), $.getJSON("js/devextreme/js/unicode-cldr/timeData.json"), $.getJSON("js/devextreme/js/unicode-cldr/weekData.json"), $.getJSON("js/devextreme/js/unicode-cldr/currencyData.json"), $.getJSON("js/devextreme/js/unicode-cldr/numberingSystems.json")).then(function() { return [].slice.apply(arguments, [0]).map(function(a) { return a[0] }) }).then(Globalize.load).then(function() { Globalize.locale("ru"); var k = { dataGridQualityRating: a, gridQualityRatingOptions: { dataSource: a, columnAutoWidth: !0, allowColumnResizing: !0, showRowLines: !0, showBorders: !0, rowAlternationEnabled: !1, hoverStateEnabled: !0, wordWrapEnabled: !0, stateStoring: { enabled: !0, type: "localStorage", storageKey: "gridQualityRating" }, searchPanel: { visible: !0 }, selection: { mode: "multiple", allowSelectAll: !0, showCheckBoxesMode: "none" }, export: { enabled: !0, allowExportSelectedData: !0 }, pager: { visible: !0, allowedPageSizes: [5, 10, 15, 50], showInfo: !0, showNavigationButtons: !0, showPageSizeSelector: !0 }, columnChooser: { enabled: !0, mode: "select" }, paging: { pageSize: 10 }, groupPanel: { visible: !0 }, grouping: { autoExpandAll: !1, contextMenuEnabled: !0 }, commonColumnSettings: { alignment: "center" }, columns: [{ dataField: "a", caption: "Дата", width: 85 }, { dataField: "b", caption: "Время", width: 80 }, { dataField: "c", caption: "Клиент" }, { dataField: "d", caption: "Сотрудник" }, { dataField: "e", caption: "Внешняя линия" }, { dataField: "f", caption: "Время разговора", width: 85 }, { dataField: "g", caption: "Оценка", width: 85 }, { dataField: "", caption: "Запись", width: 60 }], onCellPrepared: function(a) { var b = ""; "Запись" == a.column.caption && "data" == a.rowType && "" != a.data.h && (b = "<div class='rec-actions' file='" + a.data.h + "'><div class='icon play action play-rec' title='Воспроизвести запись'></div><div class='icon save action save-rec' title='Сохранить запись'></div></div>", a.cellElement.html(b)) }, onInitialized: function(a) { $("#gridQualityRating").on("click", ".play-rec", function(a) { var b = $(this).parent(), c = b.attr("file"), d = "", e = void 0, f = $("#player"); if (a.stopPropagation(), -1 == c.indexOf("mp3")) { for (var g = 0; g < window.app.data.dataGridQualityRating.length; g++)if (window.app.data.dataGridQualityRating[g].h == c) { var h = window.app.data.dataGridQualityRating[g].a.substr(0, 10).split("."); e = h[2] + "/" + h[1] + "/" + h[0] + " " + window.app.data.dataGridQualityRating[g].b } d = new Date(e) > new Date(window.app.options.urlAtsDate) ? window.app.options.urlAtsNew + c : window.app.options.urlAts + c } else d = c; -1 == c.indexOf("mp3") ? $.ajax({ type: "GET", url: "http://193.227.134.65/js/copy-records.php?link=" + d, dataType: "jsonp", success: function(a) { b.attr("file", a[0]), f.attr("src", a[0]), $(".responsive-audio").css("display", "") }, error: function(a, b, c) { console.log(a.status), console.log(c) } }) : f.attr("src", d) }), $("#gridQualityRating").on("click", ".save-rec", function(a) { var b = $(this).parent(), c = b.attr("file"), d = ""; if (a.stopPropagation(), -1 == c.indexOf("mp3")) { for (var e = 0; e < window.app.data.dataGridQualityRating.length; e++)if (window.app.data.dataGridQualityRating[e].h == c) { var f = window.app.data.dataGridQualityRating[e].a.substr(0, 10).split("."); _dateCall = f[2] + "/" + f[1] + "/" + f[0] + " " + window.app.data.dataGridQualityRating[e].b } d = new Date(_dateCall) > new Date(window.app.options.urlAtsDate) ? window.app.options.urlAtsNew + c : window.app.options.urlAts + c } else d = c; -1 == c.indexOf("mp3") ? $.ajax({ type: "GET", url: "http://193.227.134.65/js/copy-records.php?link=" + d, dataType: "jsonp", success: function(a) { d = a[0], b.attr("file", d), location.href = "http://193.227.134.65/js/export-records.php?link=" + d }, error: function(a, b, c) { console.log(a.status), console.log(c) } }) : location.href = "http://193.227.134.65/js/export-records.php?link=" + d }), $(".responsive-audio").css("display", "none") } } }; ko.applyBindings(k, document.getElementById("page")) }) });